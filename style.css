// DOMContentLoaded

document.addEventListener("DOMContentLoaded", () => {
  const gachaBtn = document.getElementById("drawButton");
  renderInventory();
  renderRewardTable();

  gachaBtn.addEventListener("click", () => {
    playSound("start");
    flashEffect();
    gachaBtn.disabled = true;
    document.getElementById("gachaSlot").innerHTML = '<div class="rolling-text">抽選中...</div>';
    playSound("rolling");

    setTimeout(() => {
      const results = [];
      for (let i = 0; i < 5; i++) {
        results.push(drawReward());
      }
      const inv = loadInventory();
      const gained = [];
      results.forEach(name => {
        const count = inv.filter(item => item === name).length;
        if (count < MAX_HOLD) {
          inv.push(name);
          gained.push(name);
          if (getRewardChance(name) < 10) playSound("rare");
        }
      });
      saveInventory(inv);
      renderResults(gained);
      renderInventory();
      gachaBtn.disabled = false;
    }, 1800);
  });
});
